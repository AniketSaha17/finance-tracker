<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Finance Tracker</title>

<body>
  
 <script>
  // redirect to login if not authenticated
  if (!localStorage.getItem('token')) {
    window.location.href = 'login.html';
  }
  // simple helper to decode token payload (not secure verification)
  function getUsernameFromToken() {
    try {
      const t = localStorage.getItem('token');
      if (!t) return null;
      const payload = t.split('.')[1];
      const json = JSON.parse(atob(payload.replace(/-/g, '+').replace(/_/g, '/')));
      return json.sub || null;
    } catch { return null; }
  }
</script>

<header style="display:flex;justify-content:space-between;align-items:center;padding:12px 8px">
  <h1 style="margin:0">Finance Tracker</h1>
  <div>
    <span id="who" style="margin-right:12px"></span>
    <button id="logoutBtn" style="padding:6px 10px;border-radius:6px;border:none;background:#f44336;color:#fff;cursor:pointer">Logout</button>
    <button id="exportBtn" style="padding:6px 10px;border-radius:6px;border:none;background:#1976d2;color:#fff;cursor:pointer;margin-left:8px">Export CSV</button>
  </div>
</header>

<script>
  const user = getUsernameFromToken();
  if (user) document.getElementById('who').innerText = user;
</script>


<style>


  /* General Styles */
  body {
    
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f4f7f9;
    color: #333;
    margin: 0;
    padding: 0 20px;
    background: rgb(red, green, blue);
  }

  h1, h2 {
    text-align: center;
    margin-top: 20px;
  }

  /* Form Styles */
  form {
    background-color: #fff;
    padding: 20px;
    max-width: 500px;
    margin: 20px auto;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  form div {
    margin-bottom: 15px;
  }

  label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }

  input, select {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 1rem;
  }

  button {
    padding: 10px 15px;
    font-size: 1rem;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background-color: #45a049;
  }

  /* Filter Styles */
  label[for="filter"], #filter {
    display: inline-block;
    margin: 10px auto;
    font-weight: bold;
  }

  #filter {
    width: auto;
    padding: 5px 10px;
  }

  /* Table Styles */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  th, td {
    padding: 12px 15px;
    text-align: center;
  }

  th {
    background-color: #4caf50;
    color: white;
  }

  tr:nth-child(even) {
    background-color: #f2f2f2;
  }

  /* Summary Cards */
  .summary {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin: 20px 0;
  }

  .card {
    background-color: #fff;
    flex: 1 1 200px;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .card h3 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: #555;
  }

  .card p {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0;
  }

  /* Chart Container */
  .charts {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 30px;
  }

  canvas {
    background-color: #fff;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  /* Delete Button */
  .deleteBtn {
    background-color: #f44336;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .deleteBtn:hover {
    background-color: #d32f2f;
  }

</style>
</head>
<body>

<h1>Finance Tracker</h1>

<form id="txForm">
  <div>
    <label>Title</label>
    <input type="text" id="title" required>
  </div>
  <div>
    <label>Amount</label>
    <input type="number" id="amount" step="0.01" required>
  </div>
  <div>
    <label>Type</label>
    <select id="type">
      <option value="expense">Expense</option>
      <option value="income">Income</option>
    </select>
  </div>
  <div>
    <label>Category</label>
    <input type="text" id="category">
  </div>
  <button type="submit">Add Transaction</button>
</form>

<div style="text-align:center; margin: 15px 0;">
  <label for="filter">Filter:</label>
  <select id="filter">
    <option value="all">All</option>
    <option value="week">This Week</option>
    <option value="month">This Month</option>
    <option value="year">Specific Year</option>
  </select>
   <!-- Year dropdown (populated dynamically) -->
  <select id="yearSelect" style="display:none; margin-left:10px;"></select>
</div>
<h2>All Transactions</h2>
<table id="txTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Amount</th>
      <th>Type</th>
      <th>Category</th>
      <th>Date</th>   <!-- <-- Date column visible -->
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <!-- Transactions will appear here -->
  </tbody>
</table>

<h2>Summary</h2>
<div class="summary">
  <div class="card">
    <h3>Total Income</h3>
    <p id="totalIncome">0</p>
  </div>
  <div class="card">
    <h3>Total Expense</h3>
    <p id="totalExpense">0</p>
  </div>
</div>

<div class="charts">
  <canvas id="incomeExpenseChart" width="400" height="300"></canvas>
  <canvas id="monthlyChart" width="400" height="300"></canvas>
</div>

<div id="result" style="text-align:center; margin-bottom:20px;"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
</body>
</html>
